# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## What This Is

A specification-only repo containing PRDs, FRDs, and a reusable Claude Skill that together define how to build a portfolio-grade EPL 2024-25 data analysis project. No application code exists yet -- it must be generated by reading these docs and following the phased build order.

## Reading Order

Read these before writing any code:
1. `skill/data-analysis-portfolio/SKILL.md` (methodology, project structure, anti-patterns)
2. `skill/data-analysis-portfolio/references/live-season.md` (config.py template -- build this first)
3. `skill/data-analysis-portfolio/references/script-patterns.md` (Python templates)
4. `skill/data-analysis-portfolio/references/design-system.md` (dashboard colors, Chart.js config, layout)
5. `skill/data-analysis-portfolio/references/doc-templates.md` (README, cleaning-log, pipeline doc templates)
6. All `PRD/*.md` files (what to build and why)
7. All `FRD/*.md` files (exact technical behavior)

## Architecture

```
football-data.co.uk CSVs --> 01_clean.py --------\
FPL API / GitHub repo ----> 03_fetch_fpl.py ------> 02_transform.py --> dashboard_data.json --> index.html
Understat.com ------------> 04_fetch_xg.py ------/
```

- `scripts/config.py` is the single source of truth for seasons, team name maps, and source URLs. All scripts import from it.
- `02_transform.py` is the merge point -- it loads required data (matches_clean.csv) and optionally loads enrichment CSVs (players.csv, xg_*.csv) with try/except.
- `index.html` reads only from `data/dashboard_data.json`. Single-file frontend (HTML + Tailwind CDN + Chart.js CDN). No build step.

## Build Phases (Execute in Order)

**Phase 1 -- Foundation:** Create folder structure, build `scripts/config.py`, build `scripts/01_clean.py`, run it, verify 1,140 rows / 29 columns.

**Phase 2 -- Base Transform + Dashboard:** Build `scripts/02_transform.py` (match aggregations only), build `index.html`, verify 7 base charts render via `python -m http.server 8000`.

**Phase 3 -- Enrichment:** Build `scripts/03_fetch_fpl.py` and `scripts/04_fetch_xg.py`, run both, update 02_transform.py to merge all sources, update index.html for xG and player charts, verify all 10 charts render.

**Phase 4 -- Documentation + Automation:** Create `docs/cleaning-log.md`, `docs/pipeline.md`, `README.md`, `requirements.txt`, `.gitignore`, `.github/workflows/update.yml`.

**Phase 5 -- Verify:** Delete all generated data, rerun full pipeline from scratch, confirm all charts render, delete enrichment CSVs only and confirm graceful degradation.

## Common Commands

```bash
# Install dependencies
pip install -r requirements.txt

# Run full pipeline (order matters: 01 first, then 03/04 in any order, then 02 last)
python scripts/01_clean.py
python scripts/03_fetch_fpl.py
python scripts/04_fetch_xg.py
python scripts/02_transform.py

# Local preview
python -m http.server 8000
# Open http://localhost:8000
```

## Target Project Structure

```
epl-analysis/
  index.html
  data/
    raw/                        # Downloaded CSVs (auto-fetched by 01_clean.py)
    cleaned/                    # Script outputs: matches_clean.csv, players.csv, xg_*.csv
    dashboard_data.json         # JSON consumed by index.html
  scripts/
    config.py                   # Season config, team maps, URLs (build FIRST)
    01_clean.py                 # Clean raw match data
    02_transform.py             # Merge + aggregate into JSON
    03_fetch_fpl.py             # FPL player stats
    04_fetch_xg.py              # Understat xG data
  docs/
    cleaning-log.md
    pipeline.md
  .github/workflows/update.yml
  requirements.txt
  .gitignore
  README.md
```

## Non-Negotiable Constraints

- **No build step.** Dashboard is a single HTML file. No React, Webpack, or npm.
- **Graceful degradation.** Dashboard must work with ONLY match data. FPL and xG are additive -- if missing, show fallback messages, never broken charts.
- **Config-driven seasons.** No hardcoded seasons, URLs, or team name maps in any script except config.py. Adding a new season = editing config.py only.
- **Partial season safe.** Charts and tables must handle any number of matches (not assume 380 or 38 matchdays).
- **Team name consistency.** All scripts must produce identical canonical team names (e.g., "Manchester United", "Tottenham Hotspur", "Wolverhampton"). config.py is the source of truth.
- **Comments explain WHY, not WHAT.**
- **No emojis anywhere.** Code, comments, HTML, docs.
- **Dark theme.** "Bloomberg Terminal meets The Athletic" aesthetic.
- **Network errors are warnings** (don't crash pipeline). File system errors are hard failures.

## Tech Stack

| Layer | Technology |
|---|---|
| ETL | Python 3.11+, Pandas |
| APIs | requests, understatapi |
| Frontend | HTML, Tailwind CDN, Chart.js CDN |
| Fonts | DM Sans (body) + Source Serif 4 (headings) |
| Automation | GitHub Actions (weekly cron) |
| Hosting | GitHub Pages |
